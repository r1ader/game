<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    #main {
        border: 1px solid black;
    }
</style>
<body>
<h1 id="test">使用wasd控制方向</h1>
<button onclick="init()" style="height: 60px;width: 100px">开始</button>
<button onclick="if(speed>10)speed-=10;clearInterval(time);time = setInterval(run, speed);" style="height: 60px;width: 100px">加速</button>
<button onclick="if(speed<50)speed+=10;clearInterval(time);time = setInterval(run, speed);" style="height: 60px;width: 100px">减速</button>
<br>
<canvas id="main" width="1000" height="1000"></canvas>
</body>
<script>
    var c = document.getElementById('main');
    var ctx = c.getContext('2d');
    var dir = 0;
    var dx = [0, 0, 1, -1];
    var dy = [1, -1, 0, 0];
    var x = 0;
    var y = 0;
    var speed = 50;
    var length = 20;
    var pointx = 0;
    var pointy = 0;
    var time;
    //    ctx.fillStyle='black';
    //    ctx.fillRect(0,0,10,10);
    document.onkeydown = function (event) {
        var e = event || window.event || arguments.callee.caller.arguments[0];
        if (e && e.keyCode == 87&&dir!=0) { // 按 Esc
            dir=1;
        }
        if (e && e.keyCode == 83&&dir!=1) { // 按 F2
            dir=0;
        }
        if (e && e.keyCode == 68&&dir!=3) { // enter 键
            dir=2;
        }
        if (e && e.keyCode == 65&&dir!=2) { // enter 键
            dir=3;
        }
    }
    ;
    function init() {
        clearInterval(time);
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, 1000, 1000);
        speeed=50;
        x = 0;
        y = 0;
        dir = 0;
        pointx = Math.floor(Math.random() * 100) * 10;
        pointy = Math.floor(Math.random() * 100) * 10;
        ctx.fillStyle = 'black';
        ctx.fillRect(pointx, pointy, 10, 10);
        time = setInterval(run, speed);
    }

    function clear(a,b) {
        setTimeout(function () {
            ctx.fillStyle = 'white';
            ctx.fillRect(a, b, 10, 10);
        },speed*length);

    }


    function run() {

//        var test=document.getElementById('test');
//        test.innerText=speed;
        if (x == pointx && y == pointy) {
            length++;
            pointx = Math.floor(Math.random() * 100) * 10;
            pointy = Math.floor(Math.random() * 100) * 10;
            ctx.fillStyle = 'black';
            ctx.fillRect(pointx, pointy, 10, 10);
        }
        else if (x < 0 || x > 990 || y < 0 || y > 990||ctx.getImageData(x+5,y+5,1,1).data=="0,0,0,255") {
            alert('你输了');
            init();
        }
        ctx.fillStyle = 'black';
        ctx.fillRect(x, y, 10, 10);
        clear(x,y);
        x += 10 * dx[dir];
        y += 10 * dy[dir];


    }
</script>
</html>